' Déclare l'API Windows
#If VBA7 Then
    Private Declare PtrSafe Function GetTickCount64 Lib "kernel32" () As LongLong
#Else
    Private Declare Function GetTickCount64 Lib "kernel32" () As LongLong
#End If

Sub MesurerTempsExecution()
    Dim startTime As LongLong
    Dim endTime As LongLong
    Dim elapsedTime As LongLong
    Dim elapsedString As String
    
    ' Récupère le temps de départ
    startTime = GetTickCount64()
    
    ' Placez ici le code dont vous souhaitez mesurer le temps d'exécution
    ' Exemples de calculs pour simuler du travail
    Dim i As Long
    Dim somme As Double
    For i = 1 To 100000000
        somme = somme + Sqr(i)
    Next i
    
    ' Récupère le temps de fin
    endTime = GetTickCount64()
    
    ' Calcule le temps écoulé en millisecondes
    elapsedTime = endTime - startTime
    
    ' Formatte le temps écoulé
    elapsedString = FormatElapsedTime(elapsedTime)
    
    ' Affiche le résultat
    MsgBox "Le temps d'exécution est de " & elapsedString
End Sub

Function FormatElapsedTime(elapsedTime As LongLong) As String
    Dim milliseconds As LongLong
    Dim seconds As LongLong
    Dim minutes As LongLong
    Dim hours As LongLong
    Dim result As String
    
    milliseconds = elapsedTime Mod 1000
    seconds = (elapsedTime \ 1000) Mod 60
    minutes = (elapsedTime \ 60000) Mod 60
    hours = elapsedTime \ 3600000
    
    If hours > 0 Then
        result = hours & " heures, " & minutes & " minutes, " & seconds & " secondes, " & milliseconds & " millisecondes"
    ElseIf minutes > 0 Then
        result = minutes & " minutes, " & seconds & " secondes, " & milliseconds & " millisecondes"
    ElseIf seconds > 0 Then
        result = seconds & " secondes, " & milliseconds & " millisecondes"
    Else
        result = milliseconds & " millisecondes"
    End If
    
    FormatElapsedTime = result
End Function
