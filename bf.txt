es ‚Äî tu peux ¬´ faker ¬ª la date pour faire comme si on √©tait J+1, J+2, etc., et donc tester les passages Flux ‚Üí Archive sans modifier ton fichier source √† la main.
Voici un mode Simulation que tu peux coller tel quel dans ton module : il m√©morise une date simul√©e dans la base (table T_Config) et force T_Today.[Production Date] √† cette date √† chaque run, puis avance d‚Äôun jour automatiquement.

üîß Patch ‚ÄúMode Simulation de date‚Äù (pr√™t √† coller)
A) Constantes √† ajouter en haut du module (sous Option Explicit)

' ====== TEST CLOCK ======
Private Const TEST_MODE As Boolean = True      ' <-- Mets False en PROD
Private Const TEST_STEP_DAYS As Long = 1       ' pas d'avancement √† chaque run (1 = +1 jour)
Private Const TEST_START_DATE As Date = #1/1/2024#  ' date de d√©part de la simu (US literal mm/dd/yyyy)
Private Const T_CFG As String = "T_Config"
B) Helpers ‚Äúhorloge‚Äù √† coller n‚Äôimporte o√π dans le module

' Date -> litt√©ral SQL (#mm/dd/yyyy#)
Private Function SqlDate(ByVal d As Date) As String
    SqlDate = "#" & Format$(d, "mm\/dd\/yyyy") & "#"
End Function
' S'assure que T_Config existe
Private Sub EnsureConfigTable(ByVal cn As Object)
    ExecIfNotExists cn, T_CFG, _
        "CREATE TABLE " & T_CFG & " (" & _
        "  CfgKey TEXT(50) PRIMARY KEY, " & _
        "  CfgVal TEXT(255)" & _
        ")"
End Sub
' Lit une cl√© de config (ou renvoie "")
Private Function CfgGet(ByVal cn As Object, ByVal k As String) As String
    Dim rs As Object: Set rs = CreateObject("ADODB.Recordset")
    rs.Open "SELECT CfgVal FROM " & T_CFG & " WHERE CfgKey='" & k & "'", cn, 1, 3
    If Not rs.EOF Then CfgGet = rs.Fields(0).Value & ""
    rs.Close: Set rs = Nothing
End Function
' Ecrit/UPSERT une cl√© de config
Private Sub CfgSet(ByVal cn As Object, ByVal k As String, ByVal v As String)
    Dim rs As Object: Set rs = CreateObject("ADODB.Recordset")
    rs.Open "SELECT CfgVal FROM " & T_CFG & " WHERE CfgKey='" & k & "'", cn, 1, 3
    If rs.EOF Then
        rs.AddNew
        rs.Fields("CfgKey").Value = k
        rs.Fields("CfgVal").Value = v
        rs.Update
    Else
        rs.Fields("CfgVal").Value = v
        rs.Update
    End If
    rs.Close: Set rs = Nothing
End Sub
' Renvoie la date simul√©e (cr√©√©e si absente)
Private Function GetSimDate(ByVal dbPath As String) As Date
    Dim cn As Object: Set cn = GetConn(dbPath)
    EnsureConfigTable cn
    Dim s As String: s = CfgGet(cn, "SimDate")
    If Len(s) = 0 Then
        CfgSet cn, "SimDate", Format$(TEST_START_DATE, "yyyy-mm-dd")
        GetSimDate = TEST_START_DATE
    Else
        ' parse "yyyy-mm-dd" en Date
        GetSimDate = DateSerial(Left$(s, 4), Mid$(s, 6, 2), Right$(s, 2))
    End If
    cn.Close: Set cn = Nothing
End Function
' Avance la date simul√©e de TEST_STEP_DAYS
Private Sub BumpSimDate(ByVal dbPath As String)
    Dim cn As Object: Set cn = GetConn(dbPath)
    EnsureConfigTable cn
    Dim d As Date: d = GetSimDate(dbPath)
    d = DateAdd("d", TEST_STEP_DAYS, d)
    CfgSet cn, "SimDate", Format$(d, "yyyy-mm-dd")
    cn.Close: Set cn = Nothing
End Sub
' Utilitaire pour forcer une date simul√©e manuellement (ex. tests)
Public Sub SetSimDateManual()
    Dim dbPath As String: dbPath = ThisWorkbook.Path & Application.PathSeparator & DB_NAME
    Dim s As String, d As Date
    s = InputBox("Entrer la date simul√©e (yyyy-mm-dd)", "Set SimDate", "2024-01-01")
    If Len(s) = 10 Then
        On Error Resume Next
        d = DateSerial(Left$(s, 4), Mid$(s, 6, 2), Right$(s, 2))
        On Error GoTo 0
        If d > 0 Then
            Dim cn As Object: Set cn = GetConn(dbPath)
            EnsureConfigTable cn
            CfgSet cn, "SimDate", Format$(d, "yyyy-mm-dd")
            cn.Close: Set cn = Nothing
            MsgBox "SimDate = " & Format$(d, "yyyy-mm-dd"), vbInformation
        Else
            MsgBox "Date invalide.", vbCritical
        End If
    End If
End Sub
Public Sub ShowSimDate()
    Dim dbPath As String: dbPath = ThisWorkbook.Path & Application.PathSeparator & DB_NAME
    Dim d As Date: d = GetSimDate(dbPath)
    MsgBox "SimDate actuelle = " & Format$(d, "yyyy-mm-dd"), vbInformation
End Sub
C) Patch dans ta proc√©dure NormalizeToday
Ajoute √† la fin de NormalizeToday (apr√®s tes UPDATE ‚Ä¶ SET existants) :

    ' --- MODE SIMULATION : force la Production Date ---
    If TEST_MODE Then
        Dim dSim As Date: dSim = GetSimDate(dbPath)
        cn.Execute "UPDATE " & T_TODAY & " SET [Production Date] = " & SqlDate(dSim) & ";"
    End If
D) Patch dans ta macro principale MAJ_Retards_Daily_3in1_NoNzIif
Juste avant Exit Sub, apr√®s le MsgBox "Mise √† jour termin√©e ‚Ä¶" (ou juste avant le MsgBox si tu pr√©f√®res), ajoute :

    If TEST_MODE Then BumpSimDate dbPath
	Ainsi, chaque fois que tu cliques le bouton, la date simul√©e avance d‚Äô1 jour (ou de TEST_STEP_DAYS) et tout ton workflow (staging, history, flux/archives) se comporte comme si on √©tait au lendemain.

üß™ Comment tester Flux ‚Üí Archive en quelques clics
	1. Laisse TEST_MODE = True.
	2. Charge une ligne avec insuffisance < 0 pour une cl√© (Booking, NO DOSSIER CREDIT).
	3. Clique le bouton :
		‚óã la cl√© entre en Flux (VG/AM/SL selon la nature < 0), NbJoursRetard = 1.
	4. Modifie la m√™me cl√© le run suivant pour que l‚Äôinsuffisance repasse ‚â• 0 (ou supprime la ligne de la feuille).
	5. Clique √† nouveau :
		‚óã la date simul√©e avance, la nature se cl√¥ture et une ligne est archiv√©e dans T_Archive (avec EndDate √† la date simul√©e du jour).
(Tu peux visualiser la date simul√©e actuelle via ShowSimDate, et la fixer via SetSimDateManual.)

Notes importantes
	‚Ä¢ Tu as comment√© EnsureDatabaseAndSchema. Si tu n‚Äôas pas d√©j√† cr√©√© tes tables √† la main, r√©active-le au moins une fois ou ex√©cute un petit Sub qui l‚Äôappelle, sinon T_Config/T_Flux/etc. n‚Äôexisteront pas.
	‚Ä¢ Le mode Simulation ne touche que T_Today.[Production Date]. Tout le reste de la logique reste identique, y compris :
		‚óã incr√©ment via DateDiff('d', LastUpdateDate, ProductionDate) (idempotent),
		‚óã cloture quand insuff ‚â• 0 ou cl√© absente,
		‚óã DepassementNA recalcul√© chaque run,
		‚óã flags d‚Äôarchive via T_HistoryInsuff.
	‚Ä¢ En production, passe TEST_MODE = False (le code cessera de forcer la date et de l‚Äôincr√©menter).
